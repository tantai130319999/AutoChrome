var chrome=chrome||browser,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,inBefore={},tabs=new Array;function getCurrentTab(e){chrome.tabs.query({currentWindow:!0,active:!0,windowType:"normal"},function(t){chrome.runtime.lastError,e&&e(t[0])})}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}var arp={defaultValues:()=>{null==localStorage.pmonitor&&(localStorage.pmonitor="true"),null==localStorage.pmpattern&&(localStorage.pmpattern="A"),null==localStorage.sound&&(localStorage.sound="2"),null==localStorage.soundvolume&&(localStorage.soundvolume=1),null==localStorage.pm_sound_til&&(localStorage.pm_sound_til="sound"),null==localStorage.random_time&&(localStorage.random_time="true"),null==localStorage.timercheck&&(localStorage.timercheck="true"),null==localStorage.asrefresh&&(localStorage.asrefresh="true")},formatOptions:e=>{let t=!1,a="";return null!=e.track&&null!=e.track.ac&&"string"==typeof e.track.ac&&""!=e.track.ac&&(t=!0,a=e.track.ac),arp.global={track:t,trackAcc:a},arp.global},init:e=>{arp.defaultValues(),arp.autoStart();let t=arp.formatOptions(e);t.track&&arp.initTrack(t.trackAcc)},initTrack:e=>{var t=t||[];t.push(["_setAccount",e]),t.push(["_trackPageview"]),window._gaq=t,function(){var e=document.createElement("script");e.type="text/javascript",e.async=!1,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},parseUrl:(e,t=!1)=>(-1==e.search("http://")&&-1==e.search("https://")&&(e=new URL("http://"+e).href),"/"==(e=e.replace("www.","")).slice(-1)&&(e=e.replace(/.$/,"")),t&&(e=e.replace(/^https?:\/\//,"")),e),formatUrl(e){try{e=-1==e.search("http://")&&-1==e.search("https://")?new URL("http://"+e):new URL(e)}catch(e){return null}let t="/"==e.href.slice(-1)?e.href.replace(/.$/,""):e.href;t=t.replaceAll("%2A","*");var a=function(e){return e=(e=(e=e.replace("www.","")).replace(/^https?:\/\//,"")).replaceAll("%2A","*")};let r=e.host.replaceAll("%2A.","");return e.cleanUrl=a(t),e.href=t,e.host=a(e.host),e.path="/"==e.pathname?"":e.pathname,e.domain=psl.get(r),e},emailAlert:(e,t,a,r)=>{if(0==validateEmail(e))return;let o,n=new FormData;o="B"==r?"lost":"ANY"==r?"ANY":"found",n.append("e",e),n.append("b",t),n.append("u",a),n.append("p",o),n.append("userId","1"),fetch("https://autorefresh.io/mail/",{method:"POST",body:n}).then(function(e){return e.text()}).then(function(e){console.log(e)}).catch(function(e){console.error(e)})},defaultDataRefresh:function(e,t,a){try{if(!chrome.storage||!e)return;chrome.storage.local.get("domain_config",function(r){let o=r.domain_config;o||(o={});const n=o[t]||o[t+"/"];a&&a(e,n,o)})}catch(e){arp.trackErrors(e)}},tabStart:e=>{if(null!=tabs[e.id])return;let t=localStorage.asurl;if("true"==localStorage.asrefresh&&t){let a=t.split(/\r?\n/),r=arp.parseUrl(e.url,!0);a.forEach((e,t)=>{(e=e.replace(/\s/g,""))&&""!==e&&e.length>0&&(a[t]=arp.parseUrl(e,!0))}),a.indexOf(r)>-1&&arp.defaultDataRefresh(e,e.url,function(e,t){defaultRefresh(e,t,1)})}},rptStart:e=>{if(null!=tabs[e.id])return;let t=localStorage.rpttext;t&&chrome.tabs.sendMessage(e.id,{pattern:"E",words:t},function(t){chrome.runtime.lastError,null!=t&&"yes"==t.predefinedText&&arp.defaultDataRefresh(e,e.url,function(e,t){defaultRefresh(e,t,1)})})},i18n:(e,t=null)=>{let a;return null==t&&(a=chrome.i18n.getMessage(e.toLowerCase())),null!=t&&(a=chrome.i18n.getMessage(e.toLowerCase(),t)),""==a?e:a},autoStart_open:e=>{chrome.tabs.create({url:e},t=>{arp.defaultDataRefresh(t,e,function(e,t,a){chrome.tabs.onUpdated.addListener(function t(r,o,n){"complete"===o.status&&r===e.id&&(chrome.tabs.onUpdated.removeListener(t),setTimeout(()=>{defaultRefresh(n,a[n.url],1)},200))})})})},default_time:()=>{let e=5e3;return localStorage.default_time&&(e=1e3*localStorage.default_time),e},autoStart:()=>{let e=localStorage.asurl;if("true"==localStorage.autostart&&"true"==localStorage.asrestart&&e){e.split(/\r?\n/).forEach(e=>{""!=(e=e.replace(/\s/g,""))&&null!=e&&arp.autoStart_open(arp.parseUrl(e))})}},Track:(e,t)=>{null!=arp.global&&_gaq.push(["_trackEvent",e,t])},trackErrors:e=>{null!=arp.global&&_gaq.push(["_trackEvent",e.name,e.stack.toString()])}};try{arp.init({track:{ac:"UA-109860713-1"}})}catch(e){arp.trackErrors(e)}chrome.tabs.onUpdated.addListener((e,t,a)=>{if(void 0!==t.status&&"loading"===t.status){if(0!=a.url.search("http"))return;chrome.tabs.executeScript(e,{file:"js/event.js",allFrames:!1},()=>{chrome.runtime.lastError,csManager.before(a)})}void 0!==t.status&&"complete"===t.status&&(csManager.start(a),chrome.tabs.executeScript(e,{file:"js/content.js",allFrames:!1},()=>{chrome.runtime.lastError,a.url.search("//autorefresh.io/")>-1||("true"==localStorage.autostart&&arp.tabStart(a),"true"==localStorage.rpt&&arp.rptStart(a))}))});let cs_domain={},cs_blklis={};const csManager={startData(){chrome.storage.local.get(function(e){cs_domain={},cs_blklis={};let t=e.custom||null;t&&Object.entries(t).forEach(function(e){e[0];let t=e[1],a=arp.formatUrl(t.url).cleanUrl;1==t.type?cs_domain[a]?cs_domain[a].push(t):(cs_domain[a]=new Array,cs_domain[a].push(t)):cs_blklis[a]?cs_blklis[a].push(t):(cs_blklis[a]=new Array,cs_blklis[a].push(t))})})},setData(){chrome.storage&&csManager.startData()},code(e){if(!e)return null;let t=null,a=function(e){t||(t=new Array),e.forEach(function(e){t.push(e)})};return cs_domain[e.cleanUrl]&&a(cs_domain[e.cleanUrl]),cs_domain[e.host+"/*"]&&a(cs_domain[e.host+"/*"]),cs_domain["*."+e.domain+"/*"]&&a(cs_domain["*."+e.domain+"/*"]),cs_domain["*."+e.domain+e.path]&&a(cs_domain["*."+e.domain+e.path]),Object.keys(cs_blklis).forEach(function(t){if(t==e.cleanUrl||t==e.host+"/*"||t=="*."+e.domain+"/*"||t=="*."+e.domain+e.path)return;let r=cs_blklis[t];a(r)}),t},run(e,t){chrome.tabs.executeScript(e,{code:t.code,allFrames:!1},function(){chrome.runtime.lastError})},start(e){if(!e&&0!=e.url.search("http"))return;let t=csManager.code(arp.formatUrl(e.url));if(t){let a="loading"==e.status?0:1;t.forEach(function(t){t.type_inct==a&&t.turn&&0==t.cs_select&&csManager.run(e.id,t)})}},before(e){(e||0==e.url.search("http"))&&chrome.tabs.sendMessage(e.id,{greeting:"ARP_inbefore"},function(t){if(chrome.runtime.lastError,t&&"ready"==t.message){let t=csManager.code(arp.formatUrl(e.url));if(t){let a="loading"==e.status?0:1;t.forEach(function(t){t.type_inct==a&&t.turn&&0==t.cs_select&&csManager.run(e.id,t)})}}})},pageMonitor(e,t){if(!e&&0!=e.url.search("http"))return;let a=csManager.code(arp.formatUrl(e.url));a&&a.forEach(function(a){a.turn&&("A"==t&&2==a.cs_select?csManager.run(e.id,a):"B"==t&&3==a.cs_select?csManager.run(e.id,a):"ANY"==t&&4==a.cs_select&&csManager.run(e.id,a))})},pageRefresh(e,t){chrome.tabs.get(e,function(e){if(chrome.runtime.lastError,!e||0!=e.url.search("http"))return;let a=csManager.code(arp.formatUrl(e.url));a&&a.forEach(function(a){a.type_inct==t&&a.turn&&1==a.cs_select&&csManager.run(e.id,a)})})}};csManager.setData();var RELOAD_LIMIT=10,counters={},pending_reloads={},blank_page=chrome.runtime.getURL("blank.html");function loop_start(e,t,a,r,o,n,s,l={}){try{if(!e||!e.id)return;l.pmOptions&&"2"==l.pmOptions.type?chrome.tabs.sendMessage(e.id,{pattern:"ANY",options:l},i=>{chrome.runtime.lastError,i?(null==s&&(l.doc_instance=i.body),arp_loop(e,t,a,r,o,n,s,l)):chrome.tabs.reload(e.id,function(){chrome.runtime.lastError,setTimeout(function(){loop_start(e,t,a,r,o,n,s,l)},500)})}):arp_loop(e,t,a,r,o,n,s,l)}catch(e){arp.trackErrors(e)}}function defaultRefresh(e,t,a){let r,o,n;if(t||(t={}),1==a)r=-1,o=t.time_interval||1e3*localStorage.default_time,n=t.time_type||"custom";else if(2==a){let e=t.randomInterval;r=-1,o="5-30",e&&e.min&&e.max&&(o=e.min+"-"+e.max),n="rand"}else 3==a&&(r=t.timerInterval||6e5,o=t.time_interval||1e3*localStorage.default_time,n=t.time_type||"custom");let s=t.pmOptions||{};s.type||(s={type:"1",visual:!0,source:!1}),loop_start(e,r,o,n,t.checkme||null,null==t.pm_p_type?null:t.pm_p_type,t.preurl||null,{openLink:null!=t.openLink&&t.openLink,inNewTab:null!=t.inNewTab&&t.inNewTab,hardRefresh:null!=t.hardRefresh&&t.hardRefresh,refreshNumber:null!=t.refreshNumber&&t.refreshNumber,setRefNumber:t.setRefNumber||"0",pmOptions:{type:s.type,visual:s.visual,source:s.source}})}function readHotkeys(e){"true"==(localStorage.hotkeys||!1)&&("startTime"==e||"startRandom"==e||"startTimer"==e?getCurrentTab(function(t){try{if(!chrome.storage)return;chrome.storage.local.get("domain_config",function(a){let r=a.domain_config;if(r||(r={}),"startTime"==e)defaultRefresh(t,r[t.url],1);else if("startRandom"==e){if("true"!=localStorage.random_time)return;defaultRefresh(t,r[t.url],2)}else if("startTimer"==e){if("true"!=localStorage.timercheck)return;defaultRefresh(t,r[t.url],3)}})}catch(e){arp.trackErrors(e)}}):"stoptTime"==e?loop_stop():"killSound"==e&&pause_sound())}function updateTabWithBlankSandwich(e,t){chrome.tabs.update(e,{url:blank_page})}function real_start(e,t){stopBadgeTimer(e),tabs[e].status="start",chrome.tabs.onUpdated.addListener(onUpdateListener),reload_it(e,t)}function get_rand_time(e,t){return Math.round(Math.random()*(t-e-0))+(e-0)}function arp_loop(e,t,a,r,o,n,s,l={}){if(null!=e){var i=e.id;if(tabs[i]&&reload_cancel(e.id,"no"),tabs[i]=new Array,s?(tabs[i].pre_url=s,tabs[i].action_url=s):tabs[i].action_url=e.url,tabs[i].interval_time=a,"rand"==r){var c=a.split("-"),u=get_rand_time(c[0],c[1]);tabs[i].time_between_load=1e3*u}else if("timer"==r){let e=e=>parseInt(e)<10?"0"+e:e.toString();var d=a.split("-"),m=(e(d[0])+":"+e(d[1])+":"+e(d[2])).split(":"),p=60*+m[0]*60+60*+m[1]+ +m[2];tabs[i].time_between_load=1e3*p}else tabs[i].time_between_load=a;tabs[i].time_type=r,tabs[i].next_round=tabs[i].time_between_load/1e3,l.doc_instance&&(tabs[i].doc_instance=l.doc_instance),null!=o&&(tabs[i].checkme=o),null!=l.openLink&&(tabs[i].openLink=l.openLink),null!=l.inNewTab&&(tabs[i].inNewTab=l.inNewTab),null!=l.pmOptions&&(tabs[i].pm_options=JSON.parse(JSON.stringify(l.pmOptions))),n&&(tabs[i].pmpattern=n),tabs[i].options=JSON.parse(JSON.stringify(l)),tabs[i].count=0,tabs[i].hardRefresh=l.hardRefresh,tabs[i].refreshNumber=l.refreshNumber,tabs[i].setRefNumber=l.setRefNumber;var f=tabs[i].action_url;if(-1==t)tabs[i].status="start",tabs[i].wait_time=0,tabs[i].wait_next_round=0,tabs[i].displayTimer&&stopBadgeTimer(i),real_start(i,f);else{tabs[i].wait_time=t;var h=0;t.toString().search(" ")>0?(tabs[i].status="wait",h=new Date(t).getTime()-(new Date).getTime(),tabs[i].wait_next_round=Math.floor(h/1e3)):(tabs[i].status="wait",h=t,tabs[i].wait_next_round=t/1e3),tabs[i].displayTimer=window.setInterval(function(e){tabs[e].wait_next_round--,setTimerBadgeText(e)},1e3,i),tabs[i].startTime=setTimeout(function(){real_start(i,f)},h)}}}function loop_stop(){getCurrentTab(function(e){if(null!=e)try{chrome.tabs.sendMessage(e.id,{pattern:"D"},function(){chrome.runtime.lastError}),counters[e.id]=0,reload_cancel(e.id,"no")}catch(e){arp.trackErrors(e)}})}function onUpdateListener(e,t,a){if(a.url!=blank_page&&(tabs[e]&&"start"==tabs[e].status&&tabs[e].time_between_load>0||!1))if("loading"===t.status){var r=t.url||!1;tabs[e].pre_url?tabs[e].action_url=tabs[e].pre_url:r&&(tabs[e].action_url=r)}else if("complete"===t.status){if("rand"==tabs[e].time_type){var o=tabs[e].interval_time.split("-"),n=get_rand_time(o[0],o[1]);tabs[e].time_between_load=1e3*n}tabs[e].next_round=tabs[e].time_between_load/1e3,setTheBadgeText(e),setupReloadTimer(e),stopBadgeTimer(e),tabs[e].displayTimer=window.setInterval(function(e){tabs[e].next_round--,setTheBadgeText(e)},1e3,e)}}function setupReloadTimer(e){tabs[e].reloadTimer&&(clearTimeout(tabs[e].reloadTimer),tabs[e].reloadTimer=null),tabs[e].reloadTimer=window.setTimeout(function(e){reload_it(e,tabs[e].action_url)},tabs[e].time_between_load,e)}function stopBadgeTimer(e){tabs[e].displayTimer&&(clearTimeout(tabs[e].displayTimer),tabs[e].displayTimer=null)}function setTimerBadgeText(e){chrome.browserAction.setBadgeBackgroundColor({color:[0,128,0,255],tabId:e});var t=String(tabs[e].wait_next_round),a=tabs[e].wait_next_round%60,r=Math.floor(tabs[e].wait_next_round/60%60),o=Math.floor(tabs[e].wait_next_round/3600%24),n=Math.floor(tabs[e].wait_next_round/86400);if(n>999)t="9...";else if(n>9)t=String(n)+"d";else if(n>0)t=String(n)+"d"+String(o)+"h";else if(o>0){if(r<10&&(r="0"+String(r)),a%2)var s=":";else s=" ";t=String(o)+s+String(r)}else a<10&&(a="0"+String(a)),t=String(r)+":"+String(a);chrome.browserAction.setBadgeText({text:t,tabId:e})}function setTheBadgeText(e){if(tabs[e].next_round<0)chrome.browserAction.setBadgeText({text:String(),tabId:e},()=>{chrome.runtime.lastError}),stopBadgeTimer(e);else{var t=String(tabs[e].next_round),a=tabs[e].next_round%60,r=Math.floor(tabs[e].next_round/60%60),o=Math.floor(tabs[e].next_round/3600%24),n=Math.floor(tabs[e].next_round/86400);if(n>999)t="9...";else if(n>9)t=String(n)+"d";else if(n>0)t=String(n)+"d"+String(o)+"h";else if(o>0){if(r<10&&(r="0"+String(r)),a%2)var s=":";else s=" ";t=String(o)+"h"+s+String(r)}else{let e=a,o=r;if(e<10&&(e="0"+String(e)),o<10&&(o="0"+String(o)),String(e).search(".")>-1){let t="",a=String(e).split(".");a.forEach(function(e,r){1==e.length&&(e+="0"),t+=e,a.length>r+1&&(t+=":")}),e=t}t=String(o)+":"+String(e),0==r&&a>0&&a<1&&(t=String(e))}chrome.browserAction.setBadgeText({text:t,tabId:e},()=>{chrome.runtime.lastError&&(stopBadgeTimer(e),clearTimeout(tabs[e].reloadTimer))})}}function show_notification(e,t,a,r){try{var o="B"==e?arp.i18n("lost"):arp.i18n("found"),n=/(..):(..)/.exec(new Date),s=(n[1],n[1],"ANY"==e?arp.i18n("detect_any_change_title"):o+" "+arp.i18n("noti_msg_title")),l="ANY"==e?arp.i18n("detect_any_change"):arp.i18n("noti_msg",o)+' "'+t+'" ';isFirefox?chrome.notifications.create(`mynotification-${a}-${Date.now()}`,{type:"basic",title:s,message:l,iconUrl:"Icon/128.png"},()=>{}):chrome.notifications.create(`mynotification-${a}-${Date.now()}`,{type:"basic",title:s,message:l,iconUrl:"Icon/128.png",buttons:[{title:arp.i18n("show_tab")},{title:arp.i18n("dismiss")}]},()=>{});var i="";localStorage.sound&&"2"==localStorage.sound?i="./sound/sound1.mp3":localStorage.sound&&"3"==localStorage.sound?i="./sound/sound2.mp3":localStorage.sound&&"4"==localStorage.sound&&(i=localStorage.soundurl?localStorage.soundurl:"./sound/sound1.mp3"),i&&(null==document.querySelector("audio")?startAudio(i):pause_sound_with_fadeout(document.querySelector("audio"),()=>{startAudio(i)}))}catch(e){arp.trackErrors(e)}}function pause_sound(e){null==e&&(e=document.querySelector("audio")),pause_sound_with_fadeout(e,null)}function startAudio(e){let t=document.createElement("audio");t.src=e,t.loop="sound"!=localStorage.pm_sound_til,t.volume=localStorage.soundvolume,document.documentElement.appendChild(t),t.play(),"timeout"==localStorage.pm_sound_til&&setTimeout(()=>{pause_sound()},1e3*localStorage.pm_sound_timeout||5e3)}function kill_sound(){pause_sound_with_fadeout(document.querySelector("audio"),null)}function pause_sound_with_fadeout(e,t){if(e){var a=e.volume;volume_fadeout_timer=setInterval(function(){a>0?(a-=.05,e.volume=Math.max(a,0)):(null!=e&&e.parentNode&&(clearInterval(volume_fadeout_timer),e.pause(),e.parentNode.removeChild(e)),null!=t&&t())},16)}}function updateTab(e,t){try{let r=tabs[e].hardRefresh||!1;csManager.pageRefresh(e,0),counters[e]=counters[e]||0;var a={updatePredefined(e){chrome.tabs.update(e,{url:t},t=>{chrome.runtime.lastError,csManager.pageRefresh(e,1)})},update(e){0==counters[e]?chrome.tabs.update(e,{url:t},t=>{chrome.runtime.lastError,csManager.pageRefresh(e,1)}):chrome.tabs.reload(e,{bypassCache:r},t=>{chrome.runtime.lastError,csManager.pageRefresh(e,1)})},init(){"true"==localStorage.pdcheck&&""!=t?a.updatePredefined(e):a.update(e)}};tabs[e].refreshNumber?parseInt(counters[e])<parseInt(tabs[e].setRefNumber)+1?a.init():(counters[e]=0,reload_cancel(e,"no")):a.init(),counters[e]+=1}catch(e){arp.trackErrors(e)}}function reload_it(e,t){let a=tabs[e].pm_options||null,r=()=>{updateTab(e,t)};if("true"==localStorage.pmonitor){if(null==tabs[e].checkme||!tabs[e].checkme){if(!a)return void r();if("2"!=a.type)return void r()}var o=tabs[e].checkme||"";let s="";var n=tabs[e].pmpattern;if(0==tabs[e].count)updateTab(e,t);else{let l=tabs[e].openLink||!1,i=tabs[e].inNewTab||!1;chrome.tabs.sendMessage(e,{checkme:o,pattern:n,pm_options:a,instance:tabs[e].doc_instance||null,autoclick:l,inNewTab:i},function(o){chrome.runtime.lastError,null!=o&&("yes"==o.findresult?(reload_cancel(e,"yes"),o.keyword&&(s=o.keyword),a.type&&"2"==a.type&&(n="ANY"),chrome.tabs.update(e,{active:!0},e=>{chrome.runtime.lastError}),chrome.tabs.get(e,function(a){chrome.windows.getLastFocused({},function(r){null!=o.url&&""!=o.url&&!0===l&&!0===i&&chrome.tabs.create({url:o.url}),csManager.pageMonitor(a,n),show_notification(n,s,e,function(){chrome.tabs.update(e,{active:!0}),chrome.windows.update(a.windowId,{focused:!0})});var c=localStorage.pmemail;c&&arp.emailAlert(c,s,t,n)})})):r())})}}else r();tabs[e].count++}function reload_cancel(e,t){tabs[e].startTime&&clearTimeout(tabs[e].startTime),tabs[e].reloadTimer&&clearTimeout(tabs[e].reloadTimer),tabs[e].displayTimer&&clearTimeout(tabs[e].displayTimer),"yes"==t?chrome.browserAction.setBadgeText({text:"YES",tabId:e}):chrome.browserAction.setBadgeText({text:"",tabId:e}),delete tabs[e]}function requestPermissions(){chrome.permissions.request({permissions:["storage"]},e=>{e?permissions=!0:alert("Storage permissions are required")})}chrome.tabs.onUpdated.addListener(function(e,t,a){chrome.runtime.lastError,t.url==blank_page&&pending_reloads[e]&&"loading"==t.status&&delete pending_reloads[e]}),chrome.notifications.onClicked.addListener(function(e){pause_sound();let t=/\-([^)]+)\-/.exec(e)[1];chrome.tabs.update(parseInt(t),{active:!0},function(){chrome.runtime.lastError})}),chrome.notifications.onButtonClicked.addListener(function(e,t){pause_sound();let a=/\-([^)]+)\-/.exec(e)[1];0==t&&chrome.tabs.update(parseInt(a),{active:!0},function(){chrome.runtime.lastError})}),chrome.notifications.onClosed.addListener(function(e,t){pause_sound()});var extensionConnect=isFirefox?chrome.runtime:chrome.extension;function showChangeLog(){setTimeout(function(){if("true"==localStorage.update_msg){((new Date).getTime()/1e3-localStorage.update_date)/60>=720&&(chrome.tabs.create({active:!1,url:"https://autorefresh.io/options/?st=update&version="+chrome.runtime.getManifest().version}),localStorage.update_msg="false",delete localStorage.update_date),showChangeLog()}},5e3)}extensionConnect.onMessage.addListener(function(e,t,a){if("openIncognito"==e.name){let e=isFirefox?"https://autorefresh.io/help#incognito":"chrome://extensions/?id="+chrome.runtime.id;chrome.tabs.create({url:e,active:!0})}else if("save"==e.name)localStorage[e.data]=e.value;else{if("permissions"==e.name)return requestPermissions(),!0;if("custom"==e.name)csManager.setData();else if("opentab"==e.name)chrome.tabs.create({url:e.url,active:!0});else if("reset"==e.name)localStorage.clear(),chrome.storage&&chrome.storage.local.clear(),arp.defaultValues(),csManager.setData();else{if("allOptions"==e.name){new Promise(function(e,t){chrome.storage?chrome.storage.local.get(function(e){let t=e.custom?e.custom:"";a(JSON.stringify({storage:localStorage,custom:t}))}):a({storage:localStorage,custom:""})});return!0}if("getHotkeys"==e.name)a({hotkeys:localStorage.hotkeys||!1,startTime:localStorage["#shk-1_keyCode"]||!1,startRandom:localStorage["#shk-2_keyCode"]||!1,startTimer:localStorage["#shk-3_keyCode"]||!1,stoptTime:localStorage["#shk-4_keyCode"]||!1,killSound:localStorage["#shk-5_keyCode"]||!1});else if("hotKeyFunction"==e.name)readHotkeys(e.value);else if("status"==e.name){let e=tabs[t.tab.id]||!1;a({start:e})}else"update"==e.name?chrome.tabs.query({},function(e){for(var t=0;t<e.length;t++)chrome.tabs.sendMessage(e[t].id,"updateFromARP",()=>{chrome.runtime.lastError})}):"anychange"==e.name?tabs[t.tab.id].doc_instance=e.body:"tabInfo"==e.name?a({data:Object.assign({},tabs[e.id])}):"updateSystem"==e.name&&(localStorage.update_msg="false",delete localStorage.update_date)}}}),chrome.runtime.onInstalled.addListener(function(e){"install"==e.reason?chrome.tabs.create({url:"https://autorefresh.io/options/?st=welcome"}):"update"==e.reason&&localStorage.version!==chrome.runtime.getManifest().version&&(delete localStorage.update_date,delete localStorage.update_msg,localStorage.update_msg="true",localStorage.update_date=(new Date).getTime()/1e3,localStorage.version=chrome.runtime.getManifest().version)}),showChangeLog(),chrome.runtime.setUninstallURL("https://autorefresh.io/uninstalled");