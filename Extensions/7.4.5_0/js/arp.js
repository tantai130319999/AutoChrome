var toastController,chrome=chrome||browser,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,customS={},default_options={};const zinlab={template(e,t){fetch(e).then(function(e){e.text().then(function(e){t(e)})}).catch(function(e){console.log("Error: "+e.message)})},$e(e,t=null){var n=new CustomEvent(e,t);document.dispatchEvent(n)},str2HTML(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},i1(e,t=null){let n,o;return""!=(n=chrome.i18n.getMessage(e,t))&&n||(n=e),{result:n,word:o=e}},escapeHTML:e=>"string"!=typeof e?e:e.replace(/[\x26\x0A\x3c\x3e\x22\x27]/g,function(e){return"&#"+e.charCodeAt(0)+";"}),mustache(e,t){if(!t)return e;return e.replace(/\{\{([^}]+)\}\}/g,function(e){let n=(e=(e=e.slice(2,-2)).replace(/\s/g,"")).split(".");if(!(n.length>1)){let n=typeof t[e];return null==t[e]||"object"==n?"{{"+e+"}}":`${zinlab.escapeHTML(t[e])}`}if("i18n"==n[0])return zinlab.i1(n[1]).result})}};function getId(e){return document.getElementById(e)}function $node(e,t=document){return t.querySelector(e)}function readActiveData(e){var t=document.getElementById(e);return t.querySelector("input")&&t.querySelector("input").checked?"true":"false"}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function validateDomain(e){e=(e=(e=e.replace("http://","")).replace("https://","")).replace("www.","");return/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}$/.test(e)}function talkToBG(e,t){try{var n=isFirefox?chrome.runtime:chrome.extension;null==t?n.sendMessage({name:e},null):n.sendMessage({name:"save",data:e,value:t},function(){chrome.runtime.lastError})}catch(e){location.reload()}}function toastManager(e){const t=document.querySelector(".toast");t.classList.contains("hide")&&t.classList.remove("hide");var n=function(){document.querySelector(".toast--content").innerHTML=e};t.classList.contains("active")?(toastController&&clearTimeout(toastController),toastController=null,t.classList.remove("active"),setTimeout(function(){n(),t.classList.add("active")},500)):(n(),t.classList.add("active")),toastController=setTimeout(function(){t.classList.remove("active"),setTimeout(()=>{t.classList.add("hide")},350)},3e3)}function rel(e,t){let n=t.getAttribute("rel");if(!n)return;const o=document.querySelectorAll(`.${n}`),a=document.querySelectorAll(`.tag-container.${n}`),s=document.querySelector(`.notification.${n}`);o.length<1||(a.length>=1&&(e?a.forEach(e=>{e.classList.remove("disable"),e.querySelector("input").disabled=!1}):e||a.forEach(e=>{e.classList.add("disable"),e.querySelector("input").disabled=!0})),e?e&&o.forEach(e=>e.disabled=!1):o.forEach(e=>e.disabled=!0),s&&(e?s.classList.remove("hide"):s.classList.add("hide")))}function setActiveButton(e,t){let n=getId(e);if(!n)return;let o=n.querySelector("input");o&&(t?(n.classList.add("active"),o.checked=!0):(n.classList.remove("active"),o.checked=!1),rel(o.checked,o))}function timer(){return{running:!1,iv:5e3,timeout:!1,cb:function(){},start:function(e,t,n){var o=this;clearInterval(this.timeout),this.running=!0,e&&(this.cb=e),t&&(this.iv=t),n&&o.execute(o),this.timeout=setTimeout(function(){o.execute(o)},this.iv)},execute:function(e){if(!e.running)return!1;e.cb()},stop:function(){this.running=!1},set_interval:function(e){clearInterval(this.timeout),this.start(!1,e)}}}const jsEditorManager={delay:.2,timer_2:new timer,save(e){let t=jsEditorManager;t.timer_2.running?t.timer_2.set_interval(1e3*t.delay):t.timer_2.start(function(){csManager.save($node("#"+e),!1)},1e3*t.delay,!1)}},csManager={init(e){$z=zinlab,$z.template(chrome.runtime.getURL("assets/template/custom_template.html"),function(e){Object.entries(customS).forEach(function(t){let n=customS[t[0]];if(""!=n.name){n.id_custom=t[0];let o=$z.str2HTML($z.mustache(e,n));$node('[name="turn"]',o).checked=n.turn||!1,$node('[name="cs_select"]',o).selectedIndex=n.cs_select||0,$node('[name="type"]',o).selectedIndex=n.type||0,$node('[name="type_inct"]',o).selectedIndex=n.type_inct||0,csManager.addEvents(o),$node("#custom-data").appendChild(o)}}),zinlab.$e("jsEditor",null),document.addEventListener("save_custom",e=>{csManager.storageCustom(e.detail)})})},newItem(){chrome.storage||talkToBG("permissions",null),setTimeout(()=>{csManager.addEvents($node(".is-open"))},60)},addEvents(e){e&&(e.querySelectorAll("select").forEach(function(e){e.onchange=function(){csManager.save(e)}}),e.addEventListener("delete",e=>{let t=e.target.getAttribute("script-id");csManager.delete(t)}),e.querySelector("pre").addEventListener("update",e=>{jsEditorManager.save(e.target.id)}))},set(e,t,n=!0){let o=customS;o[e]=t,chrome.storage&&chrome.storage.local.set({custom:o},function(){n&&toastManager(chrome.i18n.getMessage("alert_msg3")),customS=o,talkToBG("custom",null)})},save(e,t=!0){if(!e)return;let n=e.closest(".custom-script"),o=n.getAttribute("script-id");o||(o="c"+Date.now(),n.setAttribute("script-id",o)),zinlab.$e("start_save",{detail:JSON.stringify({id:o,noti:t})})},storageCustom(e){if(!e)return;let t=$node('[script-id="'+e.id+'"]'),n=this.format(t,e.code);if(n){this.set(e.id,n,e.noti);let o=$node(".name",t),a=$node(".url",t);o&&(o.innerHTML=n.name),a&&(a.innerHTML=n.url)}},format(e,t){let n=$node('[name="name"]',e).value,o=$node('[name="url"]',e).value,a=$node('[name="type"]',e).selectedIndex,s=$node('[name="turn"]',e).checked,r=$node('[name="cs_select"]',e).selectedIndex,c=$node('[name="type_inct"]',e).selectedIndex;return""==o?null:{name:n,url:o,type:a,code:t,cs_select:r,type_inct:c,turn:s}},delete(e){let t=customS;e&&t[e]&&(t[e]&&delete t[e],chrome.storage&&chrome.storage.local.set({custom:customS},function(){customS=t,talkToBG("custom",null)}))}};function save_options(){getId("default_time").value<0&&(getId("default_time").value=0);let e=getId("ea").value;if(e&&0==validateEmail(e))return alert("The email is not valid");talkToBG("default_time",getId("default_time").value),talkToBG("random_time",readActiveData("randomTime")),talkToBG("asurl",getId("as2").value),talkToBG("timercheck",readActiveData("timercheck")),talkToBG("pdcheck",readActiveData("pdcheck")),talkToBG("pdurl",getId("pdurl").value),talkToBG("rpt",readActiveData("rpt")),talkToBG("rpttext",getId("rpttext").getAttribute("tag-value")||getId("rpttext").value),talkToBG("autostart",readActiveData("autostart")),talkToBG("asrestart",getId("asrestart").checked),talkToBG("asrefresh",getId("asrefresh").checked),talkToBG("pmemail",e),talkToBG("defaultpgtxt",getId("defaultpgtxt").getAttribute("tag-value")||getId("defaultpgtxt").value),talkToBG("hotkeys",readActiveData("hotkeys")),getId("pagemr01").checked?talkToBG("pmpattern","A"):talkToBG("pmpattern","B"),getId("pmsound01").checked?talkToBG("sound","1"):getId("pmsound02").checked?talkToBG("sound","2"):getId("pmsound03").checked?talkToBG("sound","3"):getId("pmsound04").checked&&talkToBG("sound","4"),talkToBG("soundurl",getId("soundurl").value),talkToBG("soundvolume",getId("soundvolume").value),getId("pm_sound_til_click").checked?talkToBG("pm_sound_til","click"):getId("pm_sound_til_sound").checked?talkToBG("pm_sound_til","sound"):getId("pm_sound_til_timeout").checked&&talkToBG("pm_sound_til","timeout"),talkToBG("pm_sound_timeout",getId("pm_sound_timeout").value),talkToBG("support",!document.getElementById("dontsupport").checked),hotkeyManager.saveHotKey(["#shk-1","#shk-2","#shk-3","#shk-4","#shk-5"]);let t=document.querySelector(".success");t.style.display="flex",talkToBG("update",null),setTimeout(()=>{t.style.display="none"},5e3),toastManager(chrome.i18n.getMessage("alert_msg3"))}var tagInputManager=function(e,t){var n=function(e){const t=e.querySelectorAll(".tag");t.length<1||t.forEach(e=>{const t=e.parentElement;t&&t.removeChild(e)})};let o=getId(e);if(o.setAttribute("tag-value",t),""==t)return n(o.parentElement),void o.removeAttribute("tag-value");var a,s;a=o.parentElement,s=t.split("[^or]"),n(a),s.slice().reverse().forEach(function(e){const t=function(e){const t=document.createElement("span");t.classList.add("tag"),t.innerHTML=e;const n=document.createElement("span");return"@@"==e.substring(0,2)&&t.classList.add("special"),n.classList.add("close-btn"),n.setAttribute("data-item",e),t.appendChild(n),t}(e);a.prepend(t)})},hotkeyManager={reserveKey:{},init(e,t){e.forEach(e=>{this.readKeyCode(e,t),this.startCapture(e)})},startCapture(e){let t=document.querySelector(e),n=[];t.addEventListener("keydown",function(e){if(e.preventDefault(),e.stopPropagation(),8==e.keyCode){let e=t.getAttribute("fire-hotkey");e&&hotkeyManager.reserveKey[e]&&delete hotkeyManager.reserveKey[e],t.value="",t.setAttribute("fire-hotkey",""),n=[],save_options()}else-1==n.indexOf("["+e.key+"]")&&n.push("["+e.key+"]")});t.addEventListener("keyup",function(e){n&&n.length>1&&n.length<4&&((e=>{if(hotkeyManager.reserveKey[e]){let t=document.getElementById(hotkeyManager.reserveKey[e]);t.value="",t.setAttribute("fire-hotkey","")}let n=t.getAttribute("fire-hotkey");n&&delete hotkeyManager.reserveKey[n],t.setAttribute("fire-hotkey",e),hotkeyManager.reserveKey[e]=t.id,e=e.toUpperCase().replace(/(?<=\]),(?=\[)/g," + ").replace(/\[|\]/g,""),t.value=e})(n.toString()),save_options()),n=[]})},readKeyCode(e,t){let n=document.querySelector(e);n.removeAttribute("fire-hotkey"),n.value="";let o=t[e+"_keyCode"]||!1;hotkeyManager.reserveKey[o]=n.id,""!=o&&o&&(n.setAttribute("fire-hotkey",o),n.value=o.toUpperCase().replace(/(?<=\]),(?=\[)/g," + ").replace(/\[|\]/g,""))},saveHotKey(e){e.forEach(e=>{let t=document.querySelector(e);t&&talkToBG(e+"_keyCode",t.getAttribute("fire-hotkey"))})}};function fill_options(e){(e.custom||""!=e.custom)&&(customS=e.custom);let t=e.storage;t.default_time?getId("default_time").value=t.default_time:getId("default_time").value=12,setActiveButton("randomTime","true"==t.random_time),setActiveButton("autostart","true"==t.autostart),getId("asrestart").checked="true"==t.asrestart,getId("asrefresh").checked="true"==t.asrefresh,getId("as2").value=t.asurl||"",setActiveButton("rpt","true"==t.rpt),tagInputManager("rpttext",t.rpttext||""),setActiveButton("pdcheck","true"==t.pdcheck),getId("pdurl").value=t.pdurl||"",setActiveButton("timercheck","true"==t.timercheck),tagInputManager("defaultpgtxt",t.defaultpgtxt||""),t.pmpattern&&"B"==t.pmpattern?getId("pagemr02").checked=!0:getId("pagemr01").checked=!0,t.sound&&"2"==t.sound?getId("pmsound02").checked=!0:t.sound&&"3"==t.sound?getId("pmsound03").checked=!0:t.sound&&"4"==t.sound?getId("pmsound04").checked=!0:getId("pmsound01").checked=!0,getId("soundvolume").value=t.soundvolume,getId("soundurl").value=t.soundurl||"",getId("ea").value=t.pmemail||"",t.pm_sound_til||(t.pm_sound_til="sound"),getId("pm_sound_til_"+t.pm_sound_til).checked=!0,getId("pm_sound_timeout").value=t.pm_sound_timeout||5,setActiveButton("hotkeys","true"==t.hotkeys),hotkeyManager.init(["#shk-1","#shk-2","#shk-3","#shk-4","#shk-5"],t),csManager.init(),document.getElementById("dontsupport").checked="false"==t.support,document.dispatchEvent(new Event("updateTag")),startReadEvents()}function read_options(){chrome.runtime.sendMessage({name:"allOptions"},e=>{fill_options(JSON.parse(e))})}var volume_change_timer,volume_fadeout_timer,sound=new Audio,is_sound_playing=!1;function play_sound(){if(clearInterval(volume_fadeout_timer),getId("pmsound02").checked)var e=chrome.runtime.getURL("sound/sound1.mp3");else if(getId("pmsound03").checked)e=chrome.runtime.getURL("sound/sound2.mp3");else if(getId("pmsound04").checked)e=getId("soundurl").value;e&&(sound.src="",sound.volume=getId("soundvolume").value,sound.src=e,sound.play())}function addRel(e){let t=document.createElement("link");t.type="text/css",t.setAttribute("rel","stylesheet"),t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}function addLocaleToDOM(){var e=document.createElement("script");e.innerHTML=`\n        const _arp_locale_ = {\n            txt_1: "${chrome.i18n.getMessage("whitelist")}",\n            txt_2: "${chrome.i18n.getMessage("blacklist")}",\n            txt_3: "${chrome.i18n.getMessage("cs_t1")}",\n            txt_4: "${chrome.i18n.getMessage("cs_t2")}",\n            txt_5: "${chrome.i18n.getMessage("cs_t3")}",\n            txt_6: "${chrome.i18n.getMessage("cs_t4")}",\n            txt_7: "${chrome.i18n.getMessage("cs_t5")}",\n            txt_8: "${chrome.i18n.getMessage("cs_t6")}",\n            txt_9: "${chrome.i18n.getMessage("cs_t7")}"\n        }\n    `,document.body.appendChild(e)}function addSrc(e){var t=document.createElement("script");t.src=e,t.textContent="var jsonLang = 15;",document.body.appendChild(t)}function pause_sound_with_fadeout(e){var t=e.volume;volume_fadeout_timer=setInterval(function(){t>0?(t-=.05,e.volume=Math.max(t,0)):(clearInterval(volume_fadeout_timer),e.pause())},16)}function resetOptions(){talkToBG("reset",null),toastManager(chrome.i18n.getMessage("alert_msg1")),customS={},document.querySelectorAll(".custom-script").forEach(function(e){e.remove()}),setTimeout(()=>{read_options()},300)}function addUpdateMessage(e){if(e!=localStorage.version){let t=document.querySelector("#arp-options");fetch(chrome.runtime.getURL("assets/template/update_list.html")).then(function(n){n.text().then(function(n){let o=document.createElement("div");n=$z.mustache(n,{version:e}),o.innerHTML=startI18n(n),t.insertBefore(o,t.firstElementChild),o.querySelector("#ok").onclick=function(){chrome.runtime.sendMessage({name:"updateSystem"},null),localStorage.version=e,o.remove()}})})}}function init(){(document.querySelectorAll(".help-btn").forEach(e=>{e.addEventListener("click",e=>{let t=document.body,n=e.target.closest("button").getAttribute("sd-content");document.querySelector("#sb-title").innerHTML=chrome.i18n.getMessage(n+"_title"),document.querySelector("#sb-body").innerHTML=chrome.i18n.getMessage(n+"_body"),setTimeout(()=>{t.classList.add("active-hs")},100)})}),getId("test-play").onclick=play_sound,document.getElementsByName("pmsound").forEach(e=>{e.onclick=play_sound}),getId("soundvolume").onchange=function(){sound.volume=this.value,sound.paused&&play_sound(),clearTimeout(volume_change_timer),volume_change_timer=setTimeout(function(){pause_sound_with_fadeout(sound)},2e3)},getId("incognito").onclick=function(){talkToBG("openIncognito",null)},document.querySelector(".btn-reset").onclick=function(){resetOptions()},document.querySelector("#custom-script-add").onclick=function(e){csManager.newItem()},"true"!==localStorage.welcome&&setTimeout(()=>{toastManager(chrome.i18n.getMessage("alert_msg2")),localStorage.welcome="true"},500),location.href.search("st=update")>0)&&addUpdateMessage(chrome.runtime.getManifest().version);$(".help-text").click(function(e){window.open("https://autorefresh.io/expressions/")}),document.querySelectorAll("input").forEach(function(e){e.onchange=function(){"number"==e.type&&(e.step||(e.value=parseInt(e.value)),e.max&&e.value>e.max&&(e.value=e.max),e.min&&e.value<e.min&&(e.value=e.min))}})}var arp_options={optionpage:()=>window.location.pathname.search("/options")>-1,injectOptionPage:()=>{addRel(chrome.runtime.getURL("/assets/css/ratings.css")),addRel(chrome.runtime.getURL("/assets/css/style.css")),addRel(chrome.runtime.getURL("/assets/css/custom.css"));let e=document.querySelector("#arp-options");fetch(chrome.runtime.getURL("assets/template/options.html")).then(function(t){t.text().then(function(t){e.innerHTML=startI18n(t),addLocaleToDOM(),addSrc(chrome.runtime.getURL("/assets/js/script.js")),setTimeout(()=>{read_options(),$("#cancel").click(function(){window.close()}),init()},200)})}).catch(function(e){console.log("Error: "+e.message)})},init:()=>{arp_options.optionpage()&&arp_options.injectOptionPage();let e=document.querySelector(".section-cta");null!=e&&e.classList.add("installed");let t=document.querySelector(".active-btn");null!=e&&null!=t.childNodes[2]&&(t.childNodes[2].nodeValue="Installed");let n=document.querySelector(".setting-link");null!=n&&n.classList.remove("hide")}};document.addEventListener("DOMContentLoaded",function(e){arp_options.init()});const arp_alreadyInjected=document.documentElement.hasAttribute("data-arp-installed");function startReadEvents(){document.addEventListener("change",function(e){if("tags-input"==e.target.classList.value)return;let t=e.target.closest(".custom-script");if(t)return""==t.querySelector('[name="name"]').value?null:void csManager.save(e.target);save_options()}),document.addEventListener("onchangetag",e=>{save_options()}),document.addEventListener("delete_custom",csManager.delete)}arp_alreadyInjected||document.documentElement.setAttribute("data-arp-installed","true");