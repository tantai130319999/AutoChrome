function injectScript(t,e){var o=document.getElementsByTagName(e)[0];var n=document.createElement("script");var u=document.createElement("script");n.setAttribute("type","text/javascript");u.setAttribute("type","text/javascript");n.append(`Autotube = ${t}()`);o.appendChild(n);u.append("autotube = Autotube = new Autotube();");o.appendChild(u);n.remove()}let Autotube=function t(e){const o=window.MutationObserver||window.WebKitMutationObserver;const n={loadedAt:Date.now(),_autoSkip:null,_autoLoop:null,_autoShuffle:null,_reloadDurationCheck:120*60*1e3,_debug:false,getIsAutoSkip:function(){return n._autoSkip},getIsAutoLoop:function(){return n._autoLoop},getIsAutoShuffle:function(){return n._autoShuffle},getReloadDurationCheck:function(){return localStorage.reloadDurationCheck?JSON.parse(localStorage.reloadDurationCheck):n._reloadDurationCheck},getDebug:function(){return n._debug},setAutoSkip:function(t){return n._autoSkip=t},setAutoLoop:function(t){return n._autoLoop=t},setAutoShuffle:function(t){return n._autoShuffle=t},setReloadDurationCheck:function(t){return parseInt(t)>=0?n._reloadDurationCheck=t:n._reloadDurationCheck},setDebug:function(t){return typeof t==="boolean"?n._debug=t:n._debug}};const u={player:()=>document.getElementById("movie_player"),loop:{button:()=>a(0),status:function(){return u.loop.button()?JSON.parse(u.loop.button().classList.contains("style-default-active")):undefined}},shuffle:{button:()=>a(1),status:function(){return u.shuffle.button()?JSON.parse(u.shuffle.button().classList.contains("style-default-active")):undefined}}};function a(t){return[...document.querySelectorAll("[id='playlist-action-menu'] [id='top-level-buttons']")].find(t=>t.childElementCount>0).children[t]}const l=()=>{if(n.getIsAutoSkip()==true&&u.player().getPlayerState()===0){u.player().setAutonav(true);const t=u.player().getPlaylistIndex();const e=u.player().getPlaylist();if(e===null||e===undefined){return u.player().nextVideo()}if(n.getIsAutoLoop()&&n.getIsAutoShuffle()){const o=()=>{const n=Math.abs(Math.floor(Math.random()*e.length));if(n==t)return o();return n};u.player().playVideoAt(o());return}else if(n.getIsAutoLoop()){const o=e.length-1==t?0:t+1;u.player().playVideoAt(o);return}else{e.length-1==t?u.player().nextVideo():u.player().playVideoAt(t+1)}}else{u.player().setAutonav(false)}};const i=()=>{if(u.player().getCurrentTime()<=0){n.loadedAt<=Date.now()-n.getReloadDurationCheck()&&r()}};const r=()=>window.location.reload();const s=()=>!!document.fullscreenElement;const c=t=>{if(u.player().getPlayerState()===2){t.click();u.player().playVideo();document.getElementsByTagName("ytd-popup-container")[0]&&document.getElementsByTagName("ytd-popup-container")[0].remove();document.getElementsByTagName("ytmusic-popup-container")[0]&&document.getElementsByTagName("ytmusic-popup-container")[0].remove();if(n.getDebug()===true)console.log("clicked")}};function d(){const t={getButton:window.document.getElementsByClassName("ytp-play-button ytp-button")[0]||window.document.getElementById("play-pause-button"),config:{attributes:true,childList:true,subtree:true},callback:(t,e)=>{if(t.some(t=>t.type==="attributes")){const t=window.document.getElementById("confirm-button")||window.document.getElementsByClassName("ytmusic-you-there-renderer")[2]||undefined;if(t){c(t);if(n.getDebug()==true)console.log("click")}else{l();i();if(n.getDebug()==true)console.log("no click")}}}};const e={setInterval:setInterval(()=>{if(window.location.href.indexOf("/watch")==-1)return;try{const n=new o(t.callback);n.observe(t.getButton,t.config);clearInterval(e.setInterval)}catch(t){window.location.reload();n.getDebug()&&console.log(t)}},1e3),setLoop:function(){if(u.loop.button()&&n.getIsAutoLoop()&&!u.loop.status()){u.loop.button().click()}},setShuffle:function(){if(u.shuffle.button()&&n.getIsAutoShuffle()&&!u.shuffle.status()){u.shuffle.button().click()}}};setInterval(()=>{try{yt.util&&yt.util.activity&&yt.util.activity.setTimestamp();if(!document.getElementById("playListActionMenuMsg")){const t=document.createElement("div");t.style=`\n                    margin: auto 0;\n                    display: block;\n                    color: #2db338;\n                    `;t.id="playListActionMenuMsg";t.append(`â¬… The default functionality for shuffle/loop buttons are overridden by AutoTube. For more info, check the settings.`);[...document.querySelectorAll("[id='playlist-action-menu'] [id='top-level-buttons']")].find(t=>t.childElementCount>0).append(t)}}catch(t){if(n.getDebug()==true)console.log(t)}},5e3);return n}function f(){return n.loadedAt}function p(){return n.getIsAutoSkip()}function g(){return n.getIsAutoLoop()}function y(){return n.getIsAutoShuffle()}function h(){return n.getReloadDurationCheck()}function m(t){return n.setReloadDurationCheck(t)}function b(t){return n.setDebug(t)}function S(){return u}function t(){this.loadedAt=f;this.isAutoSkip=p;this.isAutoLoop=g;this.isAutoShuffle=y;this.getReloadDurationCheck=h;this.setReloadDuration=t=>m(t);this.setDebug=t=>b(t);this.get_yt=S;d()}const A=(t,e)=>{switch(t){case"autoSkip":n.setAutoSkip(e);break;case"autoLoop":n.setAutoLoop(e);break;case"autoShuffle":n.setAutoShuffle(e);break}};addEventListener("message",(function(t){for(key in t.data){A(key,t.data[key])}}));return t};window.onload=t=>{chrome.runtime.onMessage.addListener(t=>{postMessage(t,"*")});chrome.storage.sync.get(null,(function(t){t={autoSkip:t.autoSkip===undefined||t.autoSkip===null?true:JSON.parse(t.autoSkip),autoLoop:t.autoLoop===undefined||t.autoLoop===null?true:JSON.parse(t.autoLoop),autoShuffle:t.autoShuffle===undefined||t.autoShuffle===null?true:JSON.parse(t.autoShuffle)};postMessage(t,"*");injectScript(Autotube,"html")}))};injectScript(Autotube,"html");